"use strict";(self.webpackChunkquotation_app_02=self.webpackChunkquotation_app_02||[]).push([[48],{1186:(e,t,n)=>{n.d(t,{A:()=>r});n(5043);var i=n(927),l=n(4117),o=n(2167),s=n(579);const a=i.Ay.span`
  padding: 0.25rem 0.5rem;
  font-size: ${e=>e.compact?"0.625rem":"0.75rem"}; // Smaller font for compact view
  font-weight: 600;
  border-radius: 9999px; /* Fully rounded */
  display: inline-flex;
  align-items: center;
  margin-bottom: 0.25rem; /* Space between labels */
  background-color: ${e=>null===e||void 0===e?void 0:e.bgColor};
  color: ${e=>e.textColor};
`,r=e=>{let{statuses:t,compact:n}=e;const{t:i}=(0,l.Bd)(),r={CLIENT_VIEWED_DOC:{bgColor:"#d1fae5",textColor:"#065f46"},YOUR_TURN:{bgColor:"#d1fae5",textColor:"#065f46"},FINALIZED:{bgColor:"#d1fae5",textColor:"#065f46"},REJECTED:{bgColor:"#fee2e2",textColor:"#b91c1c"}};Object.values(t).some((e=>e));return(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("div",{className:"flex flex-col",children:Object.entries(t).map((e=>{let[t,l]=e;const d=r[t],c=i(t);return n?(0,s.jsx)(o.A,{title:c,children:(0,s.jsxs)(a,{bgColor:l?null===d||void 0===d?void 0:d.bgColor:"#f3f4f6",textColor:l?null===d||void 0===d?void 0:d.textColor:"#a1a1a1",compact:n,children:[(0,s.jsx)("span",{children:l?"\u2022":"\u25cb"})," "]})},t):(0,s.jsx)(a,{style:{marginRight:".4rem"},bgColor:l?null===d||void 0===d?void 0:d.bgColor:"#f3f4f6",textColor:l?null===d||void 0===d?void 0:d.textColor:"#a1a1a1",compact:n,children:c},t)}))})})}},646:(e,t,n)=>{n.d(t,{A:()=>d});n(5043);var i=n(5795),l=n(1787),o=n(9577),s=n(927),a=n(579);const r=(0,s.Ay)(i.A)`
  & .MuiInputBase-input {
    background: #fff;
    text-align: right;
  }
`,d=e=>{let{label:t,value:n,onChange:i,fullWidth:s=!1,sx:d,readOnly:c}=e;return(0,a.jsx)(o.HG,{customInput:r,label:t,value:n,onValueChange:e=>{const{formattedValue:t,value:n}=e;i(n)},thousandSeparator:".",decimalSeparator:",",decimalScale:2,fixedDecimalScale:!0,fullWidth:s,sx:d,InputProps:{startAdornment:(0,a.jsx)(l.A,{position:"start",children:"\u20ac"}),readOnly:!!c||void 0}})}},1052:(e,t,n)=>{n.d(t,{A:()=>s});n(5043);var i=n(2735),l=n(6446),o=n(579);const s=e=>{let{value:t,onChange:n,readOnly:s}=e;return(0,o.jsx)(l.A,{"data-color-mode":"light",children:(0,o.jsx)(i.Ay,{value:t,onChange:e=>n(e||""),preview:s?"preview":"edit",hideToolbar:s,height:400,visibleDragbar:!1})})}},9332:(e,t,n)=>{n.d(t,{A:()=>r});n(5043);var i=n(6446),l=n(5865),o=n(4117),s=n(5693),a=n(579);const r=e=>{let{product:t,components:n}=e;const{t:r}=(0,o.Bd)(),d=(e,t)=>e*(1-(null!==t&&void 0!==t?t:0)/100),c=n.reduce(((e,t)=>{if(t.included){return e+d(t.price,t.discount)*("number"!==typeof t.quantity||isNaN(t.quantity)?1:t.quantity)}return e}),0),u=d(t.price,t.discount),x=u+c;return(0,a.jsxs)(i.A,{sx:{mt:3,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[(0,a.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:r("ProductPriceSummary")}),(0,a.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,a.jsx)(l.A,{children:r("ProductPrice")}),(0,a.jsxs)(l.A,{children:[(0,s.$)(u)," ",r("EUR")]})]}),(0,a.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,a.jsx)(l.A,{children:r("ComponentsTotal")}),(0,a.jsxs)(l.A,{children:[(0,s.$)(c)," ",r("EUR")]})]}),(0,a.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",fontWeight:"bold"},children:[(0,a.jsxs)(l.A,{children:[r("TotalPrice")," ",(0,a.jsxs)("span",{style:{fontSize:".8rem",color:"grey"},children:["(",r("WithoutTaxes"),")"]})]}),(0,a.jsxs)(l.A,{children:[(0,s.$)(x)," ",r("EUR")]})]})]})}},4999:(e,t,n)=>{n.d(t,{A:()=>E});var i=n(2505),l=n(977),o=n(3608),s=n(6581),a=n(4109),r=n(3159),d=n(3395),c=n(6164),u=n(4329),x=n(8864),h=n(7260),m=n(2167),p=n(7392),v=n(5795),A=n(4605),j=n(1962),g=n(5865),f=n(6446),y=n(1020),b=n(9720),C=n(4535),D=n(5043),w=n(2735),S=n(579);const k=e=>{let{value:t,onChange:n,readOnly:i}=e;return(0,S.jsx)(f.A,{"data-color-mode":"light",children:(0,S.jsx)(w.Ay,{value:t,onChange:e=>n(e||""),preview:i?"preview":"edit",hideToolbar:i,height:400,visibleDragbar:!1})})},I=e=>{let{initialDescription:t,onSave:n}=e;const[i,l]=(0,D.useState)(!1),[o,s]=(0,D.useState)(t);return(0,S.jsxs)(f.A,{children:[(0,S.jsxs)(f.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,S.jsx)(g.A,{variant:"h6",children:"Component Description"}),(0,S.jsx)(m.A,{title:i?"Save":"Edit",children:(0,S.jsx)(p.A,{onClick:()=>i?(n(o),void l(!1)):l(!0),children:i?(0,S.jsx)(u.A,{}):(0,S.jsx)(r.A,{})})})]}),(0,S.jsx)(k,{value:o,onChange:s,readOnly:!i})]})};var P=n(4117),R=n(1748),$=n(5693);const E=D.memo((e=>{let{components:t,onComponentChange:n}=e;const{t:C}=(0,P.Bd)(),[w,k]=(0,D.useState)(""),[E,H]=(0,D.useState)("original"),[V,G]=(0,D.useState)([]),{user:J}=(0,R.A)(),[Y,Q]=(0,D.useState)(null),[Z,K]=(0,D.useState)(null),[X,ee]=(0,D.useState)(null),[te,ne]=(0,D.useState)(null),[ie,le]=(0,D.useState)(0),[oe,se]=(0,D.useState)(!1),[ae,re]=(0,D.useState)(!1),[de,ce]=(0,D.useState)(null);(0,D.useEffect)((()=>{G(t.map(((e,t)=>({...e,originalIndex:t,discount:e.discount||0,quantity:e.quantity||1}))))}),[t]);const ue=e=>{const t=V.map((t=>({...t,included:e,discount:e&&oe?ie:t.discount,quantity:t.quantity})));G(t),n(t)},xe=(e,t)=>{const i=V.findIndex((t=>t.id===e)),l="up"===t?i-1:i+1;if(l<0||l>=V.length)return;const o=[...V],[s]=o.splice(i,1);o.splice(l,0,s);const a=o.map(((e,t)=>({...e,originalIndex:t})));G(a),n(a)},he=((e,t)=>{let n;return function(){for(var i=arguments.length,l=new Array(i),o=0;o<i;o++)l[o]=arguments[o];n&&clearTimeout(n),n=setTimeout((()=>{e(...l)}),t)}})((e=>{if(le(e),oe){const t=V.map((t=>({...t,discount:t.included?e:t.discount})));G(t),n(t)}}),300),me=(Boolean(Y),Boolean(X)),pe=(0,D.useMemo)((()=>[...V].filter((e=>e.name.toLowerCase().includes(w.toLowerCase()))).sort(((e,t)=>"original"===E?e.originalIndex-t.originalIndex:"asc"===E?e.name.localeCompare(t.name):t.name.localeCompare(e.name)))),[V,w,E]),ve=(e,t)=>{const n=null!==t&&void 0!==t?t:0;return(0,$.$)(e*(1-n/100))},Ae=(e,t)=>{G((i=>{const l=i.map((n=>{if(n.id===e){const e=t?n.quantity+1:Math.max(1,n.quantity-1);return{...n,quantity:e}}return n}));return n(l),l}))};return(0,S.jsxs)(F,{children:[(0,S.jsxs)(T,{children:[(0,S.jsx)(m.A,{title:C("SortAlphabetically"),children:(0,S.jsx)(p.A,{onClick:()=>{H((e=>"original"===e?"asc":"asc"===e?"desc":"original"))},children:(0,S.jsx)(x.A,{})})}),(0,S.jsx)(m.A,{title:C("CheckAll"),children:(0,S.jsx)(p.A,{onClick:()=>ue(!0),children:(0,S.jsx)(s.A,{})})}),(0,S.jsx)(m.A,{title:C("UncheckAll"),children:(0,S.jsx)(p.A,{onClick:()=>ue(!1),children:(0,S.jsx)(a.A,{})})}),(0,S.jsx)(v.A,{size:"small",placeholder:C("FilterByName"),value:w,onChange:e=>k(e.target.value),sx:{flexGrow:1}}),null!==J&&void 0!==J&&J.id?(0,S.jsxs)(M,{children:[(0,S.jsx)(m.A,{title:C("ActivateDiscountForAllComponents"),children:(0,S.jsx)(A.A,{control:(0,S.jsx)(j.A,{checked:oe,onChange:e=>{const t=e.target.checked;if(se(t),t){const e=V.map((e=>({...e,discount:e.included?ie:e.discount})));G(e),n(e)}},name:"useGlobalDiscount"}),label:"",sx:{marginRight:0}})}),(0,S.jsx)(v.A,{type:"number",value:ie,onChange:e=>he(Math.min(100,Math.max(0,parseInt(e.target.value)||0))),disabled:!oe||!(null!==J&&void 0!==J&&J.id),InputProps:{inputProps:{min:0,max:100}},sx:{width:"80px"}}),(0,S.jsx)(g.A,{variant:"body1",children:"%"})]}):(0,S.jsx)(S.Fragment,{})]}),pe.map((e=>{var t;return(0,S.jsxs)(N,{selected:!0===e.included,children:[(0,S.jsxs)(B,{children:[(0,S.jsx)(p.A,{size:"small",onClick:()=>xe(e.id,"up"),disabled:0===e.originalIndex,children:(0,S.jsx)(o.A,{fontSize:"small"})}),(0,S.jsx)(p.A,{size:"small",onClick:()=>xe(e.id,"down"),disabled:e.originalIndex===V.length-1,children:(0,S.jsx)(l.A,{fontSize:"small"})})]}),(0,S.jsx)(L,{control:(0,S.jsx)(j.A,{checked:!0===e.included,onChange:t=>((e,t)=>{const i=V.map((n=>n.id===e?{...n,included:t,discount:t&&oe?ie:n.discount,quantity:n.quantity}:n));G(i),n(i)})(e.id,t.target.checked)}),label:(0,S.jsxs)(O,{children:[(0,S.jsx)(m.A,{title:e.name,children:(0,S.jsx)(z,{variant:"body1",selected:!0===e.included,children:e.name})}),(0,S.jsxs)(q,{variant:"caption",selected:!0===e.included,children:[ve(e.price,null!==(t=e.discount)&&void 0!==t?t:0)," ",C("EUR"),e.discount>0&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(W,{variant:"caption",children:["(",(0,$.$)(e.price)," ",C("EUR"),")"]}),(0,S.jsxs)(U,{variant:"caption",children:["-",e.discount,"%"]})]})]})]})}),(0,S.jsxs)(f.A,{display:"flex",alignItems:"center",children:[(0,S.jsx)(m.A,{title:"Decrease quantity",arrow:!0,children:(0,S.jsx)(p.A,{onClick:()=>Ae(e.id,!1),children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(m.A,{title:"Quantity",arrow:!0,children:(0,S.jsx)(g.A,{variant:"body1",children:`${e.quantity}`})}),(0,S.jsx)(m.A,{title:"Increase quantity",arrow:!0,children:(0,S.jsx)(p.A,{onClick:()=>Ae(e.id,!0),children:(0,S.jsx)(i.A,{})})}),(0,S.jsx)(m.A,{title:"View details",arrow:!0,children:(0,S.jsx)(p.A,{onClick:t=>((e,t)=>{Q(e.currentTarget),K(t),ce(t.price),re(!1)})(t,e),children:(0,S.jsx)(h.A,{fontSize:"small"})})}),null!==J&&void 0!==J&&J.id?(0,S.jsx)(m.A,{title:"Set discount",arrow:!0,children:(0,S.jsx)(p.A,{onClick:t=>((e,t)=>{ee(e.currentTarget),ne(t)})(t,e),children:(0,S.jsx)(d.A,{fontSize:"small",color:e.discount>0?"secondary":"action"})})}):(0,S.jsx)(S.Fragment,{})]})]},e.id)})),(0,S.jsx)(y.Ay,{open:Boolean(Y),anchorEl:Y,onClose:()=>{Q(null),K(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:Z&&(0,S.jsxs)(f.A,{padding:2,children:[(0,S.jsx)(g.A,{variant:"h6",children:Z.name}),(0,S.jsx)(I,{initialDescription:Z.description||C("NoDescriptionAvailable"),onSave:e=>{const t=V.map((t=>t.id===Z.id?{...t,description:e}:t));G(t),n(t)}}),(0,S.jsx)(f.A,{display:"flex",alignItems:"center",marginTop:2,children:ae?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(v.A,{type:"number",value:de,onChange:e=>ce(Number(e.target.value)),label:C("Price"),fullWidth:!0}),(0,S.jsx)(p.A,{onClick:()=>(e=>{if(null!==de&&Z){const t=V.map((t=>t.id===e?{...t,price:de}:t));G(t),n(t),re(!1)}})(Z.id),children:(0,S.jsx)(u.A,{})})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(g.A,{variant:"subtitle1",children:[(0,$.$)(null!==de?de:Z.price)," ",C("EUR")]}),(0,S.jsx)(p.A,{onClick:()=>{re(!0)},children:(0,S.jsx)(r.A,{})})]})})]})}),(0,S.jsx)(y.Ay,{open:me,anchorEl:X,onClose:()=>{ee(null),ne(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:te&&(0,S.jsxs)(_,{children:[(0,S.jsx)(g.A,{variant:"subtitle1",children:C("Discount")}),(0,S.jsx)(b.Ay,{value:te.discount||0,onChange:(e,t)=>{((e,t)=>{if(te){const e=V.map((e=>e.id===te.id?{...e,discount:t}:e));G(e),n(e),ne({...te,discount:t})}})(0,t),ne((e=>e?{...e,discount:t}:null))},"aria-labelledby":"discount-slider",valueLabelDisplay:"auto",step:1,marks:!0,min:0,max:100}),(0,S.jsxs)(g.A,{variant:"body2",children:[C("DiscountedPrice"),": ",ve(te.price,te.discount)," ",C("EUR")]})]})})]})})),F=((0,C.Ay)(f.A)({padding:"16px",maxWidth:"300px"}),(0,C.Ay)(f.A)({borderRadius:"4px",padding:"16px",width:"100%"})),T=(0,C.Ay)(f.A)({display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px",gap:"8px",flexWrap:"wrap"}),N=(0,C.Ay)(f.A)((e=>{let{selected:t}=e;return{display:"flex",alignItems:"center",marginBottom:"8px",width:"100%","&:last-child":{marginBottom:0},opacity:t?1:.7}})),B=(0,C.Ay)(f.A)({display:"flex",flexShrink:0,marginRight:"8px"}),L=(0,C.Ay)(A.A)({flex:1,marginRight:"8px",minWidth:0,overflow:"hidden"}),O=(0,C.Ay)(f.A)({display:"flex",flexDirection:"column",minWidth:0}),z=(0,C.Ay)(g.A)((e=>{let{selected:t}=e;return{whiteSpace:"nowrap",fontWeight:t?"bold":"normal",color:t?"#000":"#666"}})),q=(0,C.Ay)(g.A)((e=>{let{selected:t}=e;return{color:t?"#000":"#666",fontWeight:t?"bold":"normal"}})),W=(0,C.Ay)(g.A)({textDecoration:"line-through",marginLeft:"4px",color:"#999"}),U=(0,C.Ay)(g.A)({marginLeft:"4px",color:"#4caf50"}),_=(0,C.Ay)(f.A)({padding:"16px",width:"250px"}),M=(0,C.Ay)(f.A)({display:"flex",alignItems:"center",gap:"8px",flexShrink:0})},4048:(e,t,n)=>{n.r(t),n.d(t,{default:()=>lt});var i=n(5903),l=n(6446),o=n(5043),s=n(2698),a=n(1748),r=n(7206),d=n(9869),c=n(4056),u=n(8780),x=n(5865),h=n(4117),m=n(690);function p(e,t){return e&&e.id?{type:"employee",id:e.id}:t&&t.id?{type:"client",id:t.id}:void 0}var v=n(8076),A=n(2420),j=n(9650),g=n(3336),f=n(1806),y=n(4882),b=n(3460),C=n(2167),D=n(9380),w=n(927),S=n(579);const k=(0,w.Ay)(v.A)`
    cursor: pointer;
    &:hover {
        background-color: #f0f0f0; /* Light gray hover effect */
    }
`,I=(0,w.Ay)(A.A)`
    max-width: 250px; /* Adjust the width to control overflow */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis; /* Ellipsis for long names */
`,P=()=>{var e;const{t:t}=(0,h.Bd)(),{updatedDocumentData:n}=(0,s.u)(),i=(null===n||void 0===n||null===(e=n.pdfUrls)||void 0===e?void 0:e.sort(((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())))||[],o=null===i||void 0===i?void 0:i.filter((e=>e.name.toLowerCase().includes("confirmation"))),a=null===i||void 0===i?void 0:i.filter((e=>e.name.toLowerCase().includes("preventivo"))),r=(e,n)=>(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(l.A,{my:2,children:(0,S.jsx)(x.A,{textAlign:"center",variant:"h6",sx:{fontWeight:"bold"},children:t(n)})}),(0,S.jsx)(j.A,{component:g.A,sx:{borderRadius:"12px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"},children:(0,S.jsxs)(f.A,{children:[(0,S.jsx)(y.A,{children:(0,S.jsxs)(v.A,{children:[(0,S.jsx)(A.A,{children:t("Name")}),(0,S.jsx)(A.A,{children:t("Timestamp")})]})}),(0,S.jsx)(b.A,{children:e.length>0?e.map(((e,t)=>(0,S.jsxs)(k,{onClick:()=>window.open(e.url,"_blank"),children:[(0,S.jsx)(I,{component:"th",scope:"row",children:(0,S.jsxs)(l.A,{display:"flex",alignItems:"center",children:[(0,S.jsx)(D.A,{sx:{fontSize:30,mr:1}}),(0,S.jsx)(C.A,{title:e.name,children:(0,S.jsx)(x.A,{variant:"subtitle1",noWrap:!0,children:e.name})})]})}),(0,S.jsx)(A.A,{children:new Date(e.timestamp).toLocaleString()})]},t))):(0,S.jsx)(v.A,{children:(0,S.jsx)(A.A,{colSpan:2,children:(0,S.jsx)(x.A,{variant:"body1",gutterBottom:!0,children:t("NoResult")})})})})]})})]});return(0,S.jsxs)(l.A,{sx:{width:"100%",height:"100%"},children:[r(o,"Confirmation PDFs"),r(a,"Preventivo PDFs")]})};var R=n(9286),$=n(1906),E=n(3140);const F=w.Ay.div`
    display: flex;
    flex-direction: column;
    margin-bottom: 1rem;
`,T=(0,w.Ay)($.A)`
    display: flex;
    align-items: center;
    justify-content: flex-start;
    width: 100%;
    padding: 1rem;
    background-color: ${e=>{let{active:t}=e;return t?"#f5f5f5":"unset"}}; /* Optional slight background change */
    border: 1px solid ${e=>{let{active:t}=e;return t?"transparent":"#ccc"}};
`,N=(0,w.Ay)(x.A)`
    flex-grow: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: normal;
    font-size: 0.9rem;
    text-transform: none;
    text-align: left;
`,B=e=>{let{revisions:t,selectedRevisionId:n,handleChosenRevision:i,resetToOriginal:o}=e;const{t:s}=(0,h.Bd)();return(0,S.jsxs)(l.A,{children:[(0,S.jsx)(x.A,{variant:"h6",sx:{mb:2},children:s("Revisions")}),t.map((e=>(0,S.jsx)(F,{children:(0,S.jsx)(C.A,{title:(0,E.M)(e.createdAt),arrow:!0,children:(0,S.jsxs)(T,{onClick:()=>i(e),active:n===e.id,children:[(0,S.jsx)(R.A,{sx:{marginRight:1,color:n===e.id?"red":"#ccc"}}),(0,S.jsx)(N,{variant:"body1",children:e.label})]})})},e.id))),(0,S.jsx)($.A,{variant:"outlined",onClick:o,sx:{mt:2,width:"100%"},children:s("ResetToOriginal")})]})};var L=n(5382),O=n(4802),z=n(3471),q=n(8348),W=n(4329),U=n(7965),_=n(4605),M=n(1962),H=n(5795),V=n(35),G=n(6600),J=n(5316),Y=n(8533),Q=n(9347),Z=n(1186),K=n(5721),X=n(1322),ee=n(8734);const te=e=>{let{changeLogs:t}=e;const{updatedDocumentData:n}=(0,s.u)(),i=e=>{const{property:t,details:i,timestamp:l}=e,{fromValue:o,toValue:s}=(e=>{const t=e.match(/__from__(.*?)__to__/),n=e.match(/__to__(.*)$/);return{fromValue:t?JSON.parse(t[1]):"Unknown",toValue:n?JSON.parse(n[1]):"Unknown"}})(i);if(null===o&&null===s||o===s)return null;let a="";if(t.includes("data.addedProducts")){var r,d;const e=t.match(/data\.addedProducts\[(\d+)\]/),i=t.match(/components\[(\d+)\]/),l=e?parseInt(e[1]):null,u=i?parseInt(i[1]):null;if(null!==l&&null!==n&&void 0!==n&&null!==(r=n.data)&&void 0!==r&&null!==(d=r.addedProducts)&&void 0!==d&&d[l]){var c;const e=n.data.addedProducts[l].name||`Product ${l+1}`;if(null!==u&&null!==(c=n.data.addedProducts[l].components)&&void 0!==c&&c[u]){const i=n.data.addedProducts[l].components[u].name||`Component ${u+1}`;a=t.includes("included")?`${e} > ${i} is now ${s?"Included":"Excluded"}`:t.includes("quantity")?`${e} > ${i} quantity changed from ${o} to ${s}`:t.includes("discount")?`${e} > ${i} discount changed from ${o}% to ${s}%`:`${e} > ${i} changed from ${o} to ${s}`}else t.includes("price")?a=`${e} price changed from ${o} to ${s}`:t.includes("discount")?a=`${e} discount changed from ${o}% to ${s}%`:t.includes("description")&&(a=`${e} description changed.`)}}else t.includes("quoteHeadDetails")?t.includes("object")?a="Quote object changed.":t.includes("description")&&(a="Quote description changed."):a=`Changed from ${o} to ${s}`;return{primary:a,secondary:l}};return(0,S.jsx)(K.A,{dense:!0,children:t.map(((e,t)=>{const n=i(e);if(!n)return null;const{primary:l,secondary:o}=n;return(0,S.jsx)(X.Ay,{children:(0,S.jsx)(ee.A,{primary:l,secondary:o})},t)}))})},ne=()=>{var e,t,n,i,r,d;const{t:c}=(0,h.Bd)(),{user:u}=(0,a.A)(),{confirmDocument:m,generatePDF:v,saveDocument:A,rejectDocument:j,changeLogs:g,updatedDocumentData:f}=(0,s.u)(),y=p(u,null===f||void 0===f||null===(e=f.data)||void 0===e?void 0:e.selectedClient),[b,w]=(0,o.useState)(!1),[k,I]=(0,o.useState)((()=>{})),[P,R]=(0,o.useState)(!1),[E,F]=(0,o.useState)(""),T=g.length>0,N=e=>{I((()=>e)),w(!0)},B=()=>w(!1),K=`mailto:${null===f||void 0===f||null===(t=f.data.selectedClient)||void 0===t?void 0:t.email}?subject=Il%20tuo%20documento%20%C3%A8%20stato%20creato&body=Gentile%20${encodeURIComponent(null===f||void 0===f||null===(n=f.data)||void 0===n||null===(i=n.selectedClient)||void 0===i?void 0:i.firstName)}%20${encodeURIComponent(null===f||void 0===f||null===(r=f.data)||void 0===r||null===(d=r.selectedClient)||void 0===d?void 0:d.lastName)},%0D%0A%0D%0AIl%20tuo%20documento%20%C3%A8%20stato%20creato.%20Trova%20i%20dettagli%20di%20seguito:%0D%0A%0D%0AIndirizzo:%20http://sermixer.micro-cloud.it:12923/client-preventive/${null===f||void 0===f?void 0:f.hash}%0D%0A%0D%0AOTP:%20${null===f||void 0===f?void 0:f.otp}%0D%0A%0D%0ACordiali%20saluti,%0D%0AIl%20tuo%20team`;return(0,S.jsxs)(ie,{children:["employee"===(null===y||void 0===y?void 0:y.type)&&(0,S.jsxs)(se,{children:[(0,S.jsx)(x.A,{variant:"h6",gutterBottom:!0,children:c("Status")}),(0,S.jsx)(Z.A,{statuses:(null===f||void 0===f?void 0:f.status)||{}})]}),null!==f&&void 0!==f&&f.status.REJECTED?(0,S.jsx)(x.A,{variant:"body1",color:"error",align:"center",gutterBottom:!0,children:c("DocumentReadOnly")}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(x.A,{variant:"h6",gutterBottom:!0,children:c("Actions")}),"employee"===(null===y||void 0===y?void 0:y.type)&&(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)(l.A,{display:"flex",alignItems:"center",children:[(0,S.jsxs)(C.A,{title:c("RevisionCreationExplanation"),arrow:!0,children:[(0,S.jsx)(q.A,{sx:{mr:1,cursor:"pointer"}})," "]}),(0,S.jsx)(_.A,{control:(0,S.jsx)(M.A,{checked:P,onChange:e=>R(e.target.checked),disabled:0===(null===g||void 0===g?void 0:g.length)}),label:c("Revision")}),P&&(0,S.jsx)(H.A,{variant:"outlined",placeholder:c("Enter revision label"),value:E,onChange:e=>F(e.target.value),size:"small",sx:{ml:1,width:"200px"}})]})}),(0,S.jsxs)(le,{children:[(0,S.jsx)(C.A,{title:c(T?P?"SaveOneRevision":"SaveChangesDesc":"NoChanges"),children:(0,S.jsx)(oe,{variant:T?"contained":"outlined",onClick:()=>{const e=P?{label:E}:null;N((()=>A(y,e)))},startIcon:(0,S.jsx)(W.A,{}),children:c(P?"SaveRevision":"SaveChanges")})}),T&&(0,S.jsx)(C.A,{title:c("DiscardChangesDesc"),children:(0,S.jsx)(oe,{variant:"outlined",onClick:()=>window.location.reload(),startIcon:(0,S.jsx)(z.A,{}),color:"error",children:c("DiscardChanges")})}),!(null!==f&&void 0!==f&&f.status.FINALIZED)&&(0,S.jsx)(C.A,{title:c("ConfirmDocumentDescription"),children:(0,S.jsx)(oe,{variant:"contained",startIcon:(0,S.jsx)(L.A,{}),onClick:()=>N(m),color:"success",children:c("ConfirmDocument")})}),"employee"===(null===y||void 0===y?void 0:y.type)&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(C.A,{title:c("HandleGeneratePDFDescription"),children:(0,S.jsx)(oe,{variant:"contained",startIcon:(0,S.jsx)(D.A,{}),onClick:()=>N(v),children:c("GeneratePDF")})}),(0,S.jsx)(C.A,{title:c("ShareDocumentDescription",{otp:null===f||void 0===f?void 0:f.otp}),children:(0,S.jsx)(oe,{variant:"contained",startIcon:(0,S.jsx)(U.A,{}),onClick:()=>window.open(K,"_blank"),children:c("ShareDocument")})}),(0,S.jsx)(C.A,{title:c("RejectDocumentDescription"),children:(0,S.jsx)(oe,{variant:"outlined",color:"error",startIcon:(0,S.jsx)(O.A,{}),onClick:()=>N(j),children:c("RejectDocument")})})]})]})]}),(0,S.jsxs)(l.A,{mt:4,children:[(0,S.jsx)(x.A,{variant:"h6",gutterBottom:!0,children:c("CurrentChanges")}),(null===g||void 0===g?void 0:g.length)>0?(0,S.jsx)(se,{children:(0,S.jsx)(te,{changeLogs:g})}):(0,S.jsx)(x.A,{variant:"body2",gutterBottom:!0,children:c("NoChanges")})]}),(0,S.jsxs)(V.A,{open:b,onClose:B,fullWidth:!0,children:[(0,S.jsx)(G.A,{children:c("ConfirmAction")}),(0,S.jsx)(J.A,{children:(0,S.jsx)(Y.A,{children:c("AreYouSure")})}),(0,S.jsxs)(Q.A,{children:[(0,S.jsx)($.A,{onClick:B,children:c("Cancel")}),(0,S.jsx)($.A,{variant:"contained",onClick:()=>{k(),B()},color:"primary",autoFocus:!0,children:c("Confirm")})]})]})]})},ie=w.Ay.div`
    display: flex;
    flex-direction: column;
    gap: 16px;
    max-width: 400px;
    margin: auto;
`,le=(0,w.Ay)(l.A)`
    display: grid;
    grid-template-columns: repeat(2, 1fr); // Two columns
    gap: 16px; // Space between buttons
`,oe=(0,w.Ay)($.A)`
    padding: 8px; // Smaller padding for smaller text
    font-size: 0.875rem; // Smaller font size
    font-weight: bold;
    border-radius: 8px; // Rounded corners
    transition: background-color 0.3s, transform 0.2s;
    text-overflow: ellipsis; // Enable ellipsis
    overflow: hidden; // Hide overflow
    white-space: nowrap; // Prevent wrapping

    &:hover {
        transform: scale(1.05); // Slightly enlarge on hover
    }
`,se=w.Ay.div`
    margin-top: 24px;
`;const ae=function(e){const{children:t,value:n,index:i,...l}=e;return(0,S.jsx)("div",{role:"tabpanel",hidden:n!==i,id:`tabpanel-${i}`,"aria-labelledby":`tab-${i}`,...l,children:n===i&&(0,S.jsx)(S.Fragment,{children:t})})};var re=n(1052);const de=e=>{let{handleChosenRevision:t,selectedRevisionId:n}=e;const{t:i}=(0,h.Bd)(),{user:r,verifyToken:v}=(0,a.A)(),{updatedDocumentData:A,updateDocumentDataFromRevision:j,setUpdatedDocumentData:g,changeLogs:f}=(0,s.u)(),[y,b]=(0,o.useState)(),[C,D]=(0,o.useState)(0);(0,o.useEffect)((()=>{v()}),[]),(0,o.useEffect)((()=>{var e;const t=p(r,null===A||void 0===A||null===(e=A.data)||void 0===e?void 0:e.selectedClient);b(t)}),[r,A]);return(0,S.jsxs)(l.A,{sx:{width:"100%",height:"100%",padding:2},children:[(0,S.jsxs)(d.A,{value:C,onChange:(e,t)=>{D(t)},"aria-label":"document management tabs",variant:"fullWidth",sx:{"& .MuiTabs-indicator":{backgroundColor:m.Ab.Blue},"& .MuiTab-root":{backgroundColor:"transparent",color:m.Ab.Black3},"& .Mui-selected":{backgroundColor:"transparent",color:m.Ab.Black3,fontWeight:"bold"}},children:[(0,S.jsx)(c.A,{label:(0,S.jsx)(u.A,{color:"error",variant:f.length>0?"dot":"standard",overlap:"rectangular",children:i("Actions")})}),"employee"===(null===y||void 0===y?void 0:y.type)&&(0,S.jsx)(c.A,{label:i("Revisions")}),"employee"===(null===y||void 0===y?void 0:y.type)&&(0,S.jsx)(c.A,{label:i("PDFs")}),"employee"===(null===y||void 0===y?void 0:y.type)&&(0,S.jsx)(c.A,{label:i("Notes")})]}),(0,S.jsxs)(l.A,{sx:{marginTop:2},children:[(0,S.jsx)(ae,{value:C,index:0,children:(0,S.jsx)(ne,{})}),(0,S.jsx)(ae,{value:C,index:1,children:(0,S.jsx)(B,{revisions:(null===A||void 0===A?void 0:A.revisions)||[],selectedRevisionId:n,handleChosenRevision:e=>{var n;const i=null===A||void 0===A||null===(n=A.revisions)||void 0===n?void 0:n.find((t=>t.id===e.id));i&&(t(i),j(i))},resetToOriginal:()=>{window.location.reload()}})}),(0,S.jsx)(ae,{value:C,index:2,children:A&&(0,S.jsx)(P,{pdfUrls:A.pdfUrls||[]})}),"employee"===(null===y||void 0===y?void 0:y.type)&&(0,S.jsx)(ae,{value:C,index:3,children:(0,S.jsxs)(l.A,{my:1,children:[(0,S.jsx)(x.A,{textAlign:"center",variant:"h5",children:i("Notes")}),(0,S.jsx)(re.A,{value:(null===A||void 0===A?void 0:A.note)||"",onChange:e=>{g((t=>({...t,note:e})))},readOnly:!1,minRows:5})]})})]})]})};var ce=n(2220),ue=n(1637),xe=n(9336),he=n(3216),me=n(4588),pe=n(8434);const ve=(0,w.Ay)(ce.A)`
  z-index: 1300; // Adjust the z-index to be higher if needed
`,Ae=(0,w.Ay)(g.A)`
  padding: 2rem;
  border-radius: 8px;
  text-align: center;
  max-width: 400px;
  margin: auto;
`,je=e=>{let{setIsLocked:t}=e;const{t:n}=(0,h.Bd)(),{originalDocumentData:i,getDocument:a,clientViewedDocument:r}=(0,s.u)(),[d,c]=(0,o.useState)(),[u,m]=(0,o.useState)(!0),{hash:p}=(0,he.g)(),[v,A]=(0,o.useState)(""),{showMessage:j}=(0,me.J)(),g=(0,he.Zp)();(0,o.useEffect)((()=>{p&&a(p)}),[p,a]),(0,o.useEffect)((()=>{i?((0,pe.q)(i.employeeID)||i.employeeID===i.employeeID)&&m(!1):m(!1)}),[i]),(0,o.useEffect)((()=>{const e=localStorage.getItem(`otp-${null===i||void 0===i?void 0:i.hash}`);e&&(c(e),setTimeout((()=>{f(e),j(n("FoundOTP"),"success")}),200))}),[null===i||void 0===i?void 0:i.hash]);const f=async e=>{e&&e===(null===i||void 0===i?void 0:i.otp)&&t(!1),d===(null===i||void 0===i?void 0:i.otp)?(r(p),localStorage.setItem(`otp-${null===i||void 0===i?void 0:i.hash}`,d),t(!1)):A("This is not the right OTP")};return(0,S.jsx)(ve,{open:!0,children:u?(0,S.jsxs)(Ae,{elevation:3,children:[(0,S.jsx)(x.A,{variant:"h6",gutterBottom:!0,children:n("LoadingDocumentInformation")}),(0,S.jsx)(ue.A,{})]}):(0,S.jsxs)(Ae,{elevation:3,children:[(0,S.jsxs)(l.A,{mb:2,children:[(0,S.jsx)(x.A,{mb:2,variant:"h5",children:n("UnlockDocument")}),(0,S.jsx)(x.A,{children:n("UnlockDocumentDescription")})]}),v&&(0,S.jsx)(l.A,{mb:2,children:(0,S.jsx)(x.A,{color:"error",children:v})}),(0,S.jsx)(H.A,{variant:"outlined",margin:"normal",label:n("Enter OTP"),value:d,onChange:e=>c(e.target.value),fullWidth:!0}),(0,S.jsx)(l.A,{mt:2,children:(0,S.jsx)($.A,{variant:"contained",color:"primary",onClick:f,disabled:!d,sx:{width:"100%",mb:2,"&.Mui-disabled":{color:"grey.500",borderColor:"grey.500",backgroundColor:"grey.300"}},children:n("Unlock")})}),(0,S.jsx)(xe.A,{sx:{my:2}}),(0,S.jsx)(x.A,{variant:"body2",gutterBottom:!0,children:n("LookingForLogin?")}),(0,S.jsx)($.A,{variant:"outlined",color:"primary",onClick:()=>g("/login"),fullWidth:!0,children:n("Login")})]})})};var ge=n(2505),fe=n(977),ye=n(3608),be=n(8903),Ce=n(7392),De=n(9720),we=n(4194),Se=n(4535),ke=n(1337),Ie=n(889),Pe=n(6605),Re=n(710);var $e=n(646),Ee=n(9577);const Fe=e=>{let{value:t,prefix:n="\u20ac"}=e;return(0,S.jsx)(Ee.HG,{value:t,displayType:"text",thousandSeparator:".",decimalSeparator:",",decimalScale:2,fixedDecimalScale:!0,prefix:n})},Te=()=>{const{t:e}=(0,h.Bd)(),[t,n]=(0,o.useState)(!1),{originalDocumentData:i,updatedDocumentData:r,updateNestedDocumentField:d}=(0,s.u)(),{user:c}=(0,a.A)(),[u,m]=(0,o.useState)(r.discount||0),{subtotal:p,discountAmount:C,subtotalAfterDiscount:D,taxAmount:w,totalAfterDiscount:k,productDetails:I}=function(e){var t,n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.22,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=(null!==(t=null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.addedProducts)&&void 0!==t?t:[]).map((e=>{var t,n,i,l,o;const s=parseFloat(null!==(t=null===(n=e.price)||void 0===n?void 0:n.toString())&&void 0!==t?t:"0")||0,a=null!==(i=e.discount)&&void 0!==i?i:0,r=s*a/100,d=s-r,c=null!==(l=null===(o=e.components)||void 0===o?void 0:o.filter((e=>e.included)).map((e=>{var t,n,i;const l=parseFloat(null!==(t=null===(n=e.price)||void 0===n?void 0:n.toString())&&void 0!==t?t:"0")||0,o=l-l*(null!==(i=e.discount)&&void 0!==i?i:0)/100;return{name:e.name,price:o,quantity:e.quantity}})))&&void 0!==l?l:[],u=c.reduce(((e,t)=>e+t.price*t.quantity),0),x=d+u;return{name:e.name,basePrice:s,discount:a,discountAmount:r,components:c,total:x}})),s=o.reduce(((e,t)=>e+t.total),0),a=l,r=Math.max(s-a,0),d=r*i;return{subtotal:s,discountAmount:a,subtotalAfterDiscount:r,taxAmount:d,totalAfterDiscount:r+d,productDetails:o}}(r,.22,u);return(0,S.jsxs)(l.A,{sx:{width:"100%",mt:2},children:[(0,S.jsxs)(Ie.A,{expanded:t,onChange:()=>{n((e=>!e))},elevation:0,sx:{border:"1px solid #e0e0e0","&:before":{display:"none"}},children:[(0,S.jsx)(Pe.A,{expandIcon:(0,S.jsx)(ke.A,{}),children:(0,S.jsx)(x.A,{variant:"h6",children:e("TotalPriceSummary")})}),(0,S.jsx)(Re.A,{sx:{p:0},children:(0,S.jsx)(j.A,{component:g.A,elevation:0,children:(0,S.jsxs)(f.A,{size:"small",children:[(0,S.jsx)(y.A,{children:(0,S.jsxs)(v.A,{children:[(0,S.jsx)(A.A,{children:e("Product")}),(0,S.jsx)(A.A,{align:"right",children:e("BasePrice")}),(0,S.jsx)(A.A,{align:"right",children:e("Discount")}),(0,S.jsx)(A.A,{align:"right",children:e("Components")}),(0,S.jsx)(A.A,{align:"right",children:e("Total")})]})}),(0,S.jsx)(b.A,{children:I.map(((e,t)=>(0,S.jsxs)(o.Fragment,{children:[(0,S.jsxs)(v.A,{sx:{backgroundColor:"white"},children:[(0,S.jsx)(A.A,{component:"th",scope:"row",sx:{fontWeight:"bold"},children:e.name}),(0,S.jsx)(A.A,{align:"right",children:(0,S.jsx)(Fe,{value:e.basePrice})}),(0,S.jsx)(A.A,{align:"right",children:e.discount>0?(0,S.jsx)(Fe,{value:-e.discountAmount}):"-"}),(0,S.jsx)(A.A,{align:"right",children:(0,S.jsx)(Fe,{value:e.components.reduce(((e,t)=>e+t.price*t.quantity),0)})}),(0,S.jsx)(A.A,{align:"right",children:(0,S.jsx)(Fe,{value:e.total})})]}),e.components.map(((e,n)=>(0,S.jsxs)(v.A,{sx:{backgroundColor:"#f5f5f5"},children:[(0,S.jsxs)(A.A,{sx:{pl:4},children:[e.name," (x",e.quantity,")"]}),(0,S.jsx)(A.A,{align:"right",children:(0,S.jsx)(Fe,{value:e.price})}),(0,S.jsx)(A.A,{colSpan:3})]},`${t}-${n}`)))]},t)))})]})})})]}),(0,S.jsxs)(l.A,{sx:{width:"50%",mt:2,ml:"auto",p:2,border:"1px solid #e0e0e0"},children:[(0,S.jsxs)(l.A,{display:"flex",justifyContent:"space-between",mb:1,children:[(0,S.jsxs)(x.A,{variant:"body1",children:[e("Subtotal"),":"]}),(0,S.jsx)(x.A,{variant:"body1",children:C>0?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{style:{textDecoration:"line-through",marginRight:"8px"},children:(0,S.jsx)(Fe,{value:p})}),(0,S.jsx)(Fe,{value:D})]}):(0,S.jsx)(Fe,{value:p})})]}),(0,S.jsxs)(l.A,{display:"flex",justifyContent:"space-between",mb:1,children:[(0,S.jsxs)(x.A,{variant:"body1",children:[e("Tax"),": ",(0,S.jsx)("span",{style:{fontSize:".8rem",color:"grey"},children:"(22%)"})]}),(0,S.jsx)(x.A,{variant:"body1",children:(0,S.jsx)(Fe,{value:w})})]}),null!==c&&void 0!==c&&c.id?(0,S.jsxs)(l.A,{display:"flex",justifyContent:"space-between",mb:1,children:[(0,S.jsxs)(x.A,{variant:"body1",children:[e("Discount"),":"]}),(0,S.jsx)($e.A,{value:u.toString(),onChange:e=>{const t=parseFloat(e)||0;m(t),d(["discount"],t)},fullWidth:!1,readOnly:!1,sx:{minWidth:"200px"}})]}):(0,S.jsx)(S.Fragment,{}),(0,S.jsx)(xe.A,{sx:{my:1}}),(0,S.jsxs)(l.A,{display:"flex",justifyContent:"space-between",children:[(0,S.jsxs)(x.A,{variant:"h6",sx:{fontWeight:"bold"},children:[e("Total"),":"]}),(0,S.jsx)(x.A,{variant:"h6",sx:{fontWeight:"bold"},children:(0,S.jsx)(Fe,{value:k})})]})]})]})};var Ne=n(5475),Be=n(1726),Le=n(3159),Oe=n(7402),ze=n(2177),qe=n(1594),We=n(4590);const Ue=()=>{var e,t,n,i,r,d,c,u,m,p,v,A,j,g;const{t:f}=(0,h.Bd)(),{updatedDocumentData:y,originalDocumentData:b,updateNestedDocumentField:C}=(0,s.u)(),{user:w,getUsers:k,users:I}=(0,a.A)(),[P,R]=(0,o.useState)(),[$,E]=(0,o.useState)(!1),[F,T]=(0,o.useState)(!1),[N,B]=(0,o.useState)((null===y||void 0===y||null===(e=y.data)||void 0===e||null===(t=e.quoteHeadDetails)||void 0===t?void 0:t.object)||""),[L,O]=(0,o.useState)((null===y||void 0===y||null===(n=y.data)||void 0===n||null===(i=n.quoteHeadDetails)||void 0===i?void 0:i.description)||"");(0,o.useEffect)((()=>{k()}),[]),(0,o.useEffect)((()=>{const e=I.find((e=>{let{id:t}=e;return`${t}`===`${null===b||void 0===b?void 0:b.employeeID}`}));e&&R(e)}),[I,null===b||void 0===b?void 0:b.employeeID]),(0,o.useEffect)((()=>{var e,t;y&&(B((null===(e=y.data.quoteHeadDetails)||void 0===e?void 0:e.object)||""),O((null===(t=y.data.quoteHeadDetails)||void 0===t?void 0:t.description)||""))}),[y]);const z=!(null!==w&&void 0!==w&&w.id);return(0,S.jsxs)(l.A,{p:3,children:[(0,S.jsxs)(be.Ay,{container:!0,spacing:3,children:[(0,S.jsx)(be.Ay,{item:!0,xs:12,md:4,children:(0,S.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",height:"100%",justifyContent:"flex-start",alignItems:"flex-start",ml:4},children:[(0,S.jsx)("img",{src:We,alt:"Logo",style:{height:80,marginBottom:20}}),(0,S.jsx)(x.A,{variant:"h4",children:(null===b||void 0===b||null===(r=b.data)||void 0===r||null===(d=r.quoteHeadDetails)||void 0===d?void 0:d.company)||"NA"})]})}),(0,S.jsx)(be.Ay,{item:!0,xs:12,md:4,children:(0,S.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",height:"100%",justifyContent:"flex-end",alignItems:"flex-start",mb:2},children:[(0,S.jsx)(x.A,{variant:"h6",gutterBottom:!0,children:f("Employee")}),(0,S.jsxs)(l.A,{children:[(0,S.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,S.jsx)(ze.A,{}),(0,S.jsxs)(x.A,{variant:"body2",ml:1,children:[f("Name"),": ",(null===P||void 0===P?void 0:P.username)||"NA"]})]}),(0,S.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,S.jsx)(Oe.A,{}),(0,S.jsxs)(x.A,{variant:"body2",ml:1,children:[f("Email"),": ",(null===P||void 0===P?void 0:P.email)||"NA"]})]}),(0,S.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,S.jsx)(Be.A,{}),(0,S.jsxs)(x.A,{variant:"body2",ml:1,children:[f("Company"),": ",(null===P||void 0===P?void 0:P.companyName)||"NA"]})]})]})]})}),(0,S.jsx)(be.Ay,{item:!0,xs:12,md:4,children:(0,S.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",height:"100%",justifyContent:"flex-end",alignItems:"flex-start",mb:2},children:[(0,S.jsx)(x.A,{variant:"h6",gutterBottom:!0,children:f("Client")}),(0,S.jsxs)(l.A,{children:[(0,S.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,S.jsx)(ze.A,{}),(0,S.jsxs)(x.A,{variant:"body2",ml:1,children:[f("Name"),": ",`${(null===b||void 0===b||null===(c=b.data)||void 0===c||null===(u=c.selectedClient)||void 0===u?void 0:u.firstName)||""} ${(null===b||void 0===b||null===(m=b.data)||void 0===m||null===(p=m.selectedClient)||void 0===p?void 0:p.lastName)||""}`.trim()||"NA"]})]}),(0,S.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,S.jsx)(Oe.A,{}),(0,S.jsxs)(x.A,{variant:"body2",ml:1,children:[f("Email"),": ",(null===b||void 0===b||null===(v=b.data)||void 0===v||null===(A=v.selectedClient)||void 0===A?void 0:A.email)||"NA"]})]}),(0,S.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,S.jsx)(Be.A,{}),(0,S.jsxs)(x.A,{variant:"body2",ml:1,children:[f("Company"),": ",(null===b||void 0===b||null===(j=b.data)||void 0===j||null===(g=j.selectedClient)||void 0===g?void 0:g.companyName)||"NA"]})]})]})]})})]}),(0,S.jsx)(xe.A,{sx:{my:3}}),(0,S.jsxs)(l.A,{children:[(0,S.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,S.jsx)(qe.A,{}),$?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(H.A,{variant:"standard",value:N,onChange:e=>B(e.target.value),fullWidth:!0,disabled:z}),!z&&(0,S.jsx)(Ce.A,{onClick:()=>{C(["data","quoteHeadDetails","object"],N),E(!1)},children:(0,S.jsx)(W.A,{})})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(x.A,{variant:"body2",children:N||"NA"}),!z&&(0,S.jsx)(Ce.A,{onClick:()=>E(!0),children:(0,S.jsx)(Le.A,{})})]})]}),(0,S.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,S.jsx)(D.A,{}),F?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(H.A,{variant:"standard",value:L,onChange:e=>O(e.target.value),fullWidth:!0,disabled:z}),!z&&(0,S.jsx)(Ce.A,{onClick:()=>{C(["data","quoteHeadDetails","description"],L),T(!1)},children:(0,S.jsx)(W.A,{})})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(x.A,{variant:"body2",children:L||"NA"}),!z&&(0,S.jsx)(Ce.A,{onClick:()=>T(!0),children:(0,S.jsx)(Le.A,{})})]})]})]})]})};var _e=n(9332),Me=n(4999),He=n(5693),Ve=n(6060),Ge=n(9647);var Je=n(7996);const Ye=(0,Ve.A)("input")({display:"none"}),Qe=(0,Ve.A)("img")({width:"100%",height:"100%",objectFit:"contain"}),Ze=()=>{const{signatureUrl:e,uploadSignature:t}=(()=>{const[e,t]=(0,o.useState)(null),[n,i]=(0,o.useState)(!1),[l,s]=(0,o.useState)(null),a=async()=>{i(!0);try{const e=await(0,Ge.E)({url:"http://sermixer.micro-cloud.it:12923/api/media/get-business-signature",method:"GET"});t(e.signatureUrl)}catch(l){s("Error fetching signature")}finally{i(!1)}};return(0,o.useEffect)((()=>{a()}),[]),{signatureUrl:e,uploadSignature:async e=>{i(!0);try{await(0,Ge.E)({url:"http://sermixer.micro-cloud.it:12923/api/media/business-signature",method:"POST",body:e}),a()}catch(l){s("Error uploading signature")}finally{i(!1)}},loading:n,error:l}})(),{updatedDocumentData:n,updateDocumentField:i}=(0,s.u)(),[a,r]=(0,o.useState)(null),[d,c]=(0,o.useState)((null===n||void 0===n?void 0:n.dateOfSignature)||"");(0,o.useEffect)((()=>{e&&r(e)}),[e]);return(0,S.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,bgcolor:"#f9f9f9",borderRadius:1},children:[(0,S.jsxs)(l.A,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,S.jsx)(x.A,{variant:"subtitle1",gutterBottom:!0,children:"Signature"}),(0,S.jsx)(l.A,{sx:{height:150,width:250,border:"1px dashed #ccc",display:"flex",justifyContent:"center",alignItems:"center",mb:2},children:(0,S.jsx)(Qe,{src:a||Je,alt:"Signature Preview"})}),(0,S.jsxs)("label",{htmlFor:"signature-upload",children:[(0,S.jsx)(Ye,{accept:"image/*",id:"signature-upload",type:"file",onChange:async e=>{if(e.target.files&&e.target.files[0]){const i=e.target.files[0];r(URL.createObjectURL(i));const l=new FormData;l.append("file",i);try{await t(l)}catch(n){console.error("Error uploading signature:",n)}}}}),(0,S.jsx)($.A,{variant:"outlined",component:"span",children:"Upload Signature"})]})]}),(0,S.jsxs)(l.A,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,S.jsx)(x.A,{variant:"subtitle1",gutterBottom:!0,children:"Date"}),(0,S.jsx)(H.A,{type:"date",value:d,onChange:e=>{const t=e.target.value;c(t),i("dateOfSignature",t)},sx:{width:200},InputLabelProps:{shrink:!0}})]})]})},Ke=(0,o.forwardRef)((function(e,t){return(0,S.jsx)(we.A,{elevation:6,ref:t,variant:"filled",...e})})),Xe=e=>{var t,n;let{activeRevisionLabel:i,revisionData:d}=e;const{t:c}=(0,h.Bd)(),{showMessage:u}=(0,me.J)(),{hash:m}=(0,he.g)(),{originalDocumentData:p,updatedDocumentData:v,setUpdatedDocumentData:A,updateNestedDocumentField:j,getDocument:g,error:f,loading:y}=(0,s.u)(),{user:b,getProducts:D,products:w}=(0,a.A)(),[k,I]=(0,o.useState)((null===v||void 0===v||null===(t=v.data)||void 0===t?void 0:t.addedProducts)||[]),[P,E]=(0,o.useState)(!1),[F,T]=(0,o.useState)(""),[N,B]=(0,o.useState)([]),[L,O]=(0,o.useState)((null===v||void 0===v||null===(n=v.data)||void 0===n?void 0:n.paymentTerms)||"MODALITA' DI PAGAMENTO: Acconto 10% e saldo alla consegna o alla richiesta dei documenti di collaudo (in mancanza del versamento dell'acconto non sar\xe0 possibile procedere con l'evasione dell'offerta)");(0,o.useEffect)((()=>{m&&g(m)}),[m,g]),(0,o.useEffect)((()=>{var e;null!==v&&void 0!==v&&null!==(e=v.data)&&void 0!==e&&e.addedProducts&&I(v.data.addedProducts)}),[v]),(0,o.useEffect)((()=>{d&&A((e=>({...e,data:d})))}),[d,A]),(0,o.useEffect)((()=>{D()}),[]),(0,o.useEffect)((()=>{var e;null!==v&&void 0!==v&&null!==(e=v.data)&&void 0!==e&&e.paymentTerms&&O(v.data.paymentTerms)}),[v]),(0,o.useEffect)((()=>{B(w.filter((e=>e.name.toLowerCase().includes(F.toLowerCase())||e.description.toLowerCase().includes(F.toLowerCase()))))}),[F,w]);const q=(e,t,n)=>{const i=[...k],l="string"===typeof n?parseFloat(n):n;i[e]={...i[e],[t]:isNaN(l)?n:l},I(i),j(["data","addedProducts"],i)},W=()=>{E(!1),T("")},U=(0,o.useCallback)((e=>{if(0===e)return;const t=[...k];[t[e-1],t[e]]=[t[e],t[e-1]],I(t),j(["data","addedProducts"],t)}),[k,j]),_=(0,o.useCallback)((e=>{if(e===k.length-1)return;const t=[...k];[t[e+1],t[e]]=[t[e],t[e+1]],I(t),j(["data","addedProducts"],t)}),[k,j]);return y?(0,S.jsx)(r.A,{}):f?(0,S.jsx)(l.A,{children:c(f)}):p?(0,S.jsxs)(l.A,{sx:{maxWidth:"1200px",margin:"0 auto",background:"#fff",p:3,paddingBottom:"300px"},children:[i&&(0,S.jsx)(l.A,{children:(0,S.jsx)(Ke,{onClose:(e,t)=>{"clickaway"!==t&&window.location.reload()},severity:"info",sx:{position:"fixed",zIndex:9999,backgroundColor:"#ffef4c",color:"black"},iconMapping:{warning:(0,S.jsx)(R.A,{fontSize:"inherit"})},children:c("YouAreViewing",{activeRevisionLabel:i})})}),(0,S.jsx)(Ue,{}),(0,S.jsx)(l.A,{sx:{mt:4,mb:6},children:0===k.length?(0,S.jsx)(l.A,{sx:{py:4,textAlign:"center",color:"text.secondary",border:"1px dashed",borderColor:"divider",borderRadius:1},children:c("NoItemsYet")}):k.map(((e,t)=>{return(0,S.jsxs)(nt,{children:[(0,S.jsx)(C.A,{title:c("RemoveProduct"),arrow:!0,children:(0,S.jsx)(it,{onClick:()=>(e=>{const t=k.filter(((t,n)=>n!==e));I(t),j(["data","addedProducts"],t),u("RemovedItemFromPreventive","success")})(t),"aria-label":c("RemoveProduct"),children:(0,S.jsx)(z.A,{})})}),(0,S.jsxs)(be.Ay,{container:!0,spacing:4,children:[(0,S.jsx)(be.Ay,{item:!0,xs:12,md:4,children:(0,S.jsxs)(l.A,{children:[(0,S.jsx)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:(0,S.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,S.jsx)(Ne.N_,{to:`/product/${e.id}`,style:{textDecoration:"none",color:"inherit"},sx:{"&:hover":{textDecoration:"underline"}},children:(0,S.jsx)(x.A,{variant:"h6",children:e.name})}),(null===b||void 0===b?void 0:b.id)&&(0,S.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",ml:1},children:[(0,S.jsx)(Ce.A,{size:"small",onClick:()=>U(t),disabled:0===t,"aria-label":"Move Up",children:(0,S.jsx)(ye.A,{fontSize:"small"})}),(0,S.jsx)(Ce.A,{size:"small",onClick:()=>_(t),disabled:t===k.length-1,"aria-label":"Move Down",children:(0,S.jsx)(fe.A,{fontSize:"small"})})]})]})}),(0,S.jsx)(l.A,{component:"img",src:e.imgUrl,alt:e.name,sx:{width:"100%",maxHeight:300,objectFit:"contain",mb:2,borderRadius:1}}),(0,S.jsx)($e.A,{label:c("ProductPrice"),value:e.price,onChange:e=>q(t,"price",e),margin:"dense",fullWidth:!0,readOnly:!(null!==b&&void 0!==b&&b.id)}),(null===b||void 0===b?void 0:b.id)&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",mt:2},children:[(0,S.jsx)(x.A,{variant:"subtitle1",sx:{mr:2},children:c("Discount")}),(0,S.jsx)(De.Ay,{value:e.discount||0,onChange:(e,n)=>q(t,"discount",n),"aria-labelledby":"product-discount-slider",valueLabelDisplay:"auto",step:1,marks:!0,min:0,max:100,sx:{flexGrow:1}}),(0,S.jsxs)(x.A,{variant:"body2",sx:{ml:2},children:[e.discount||0,"%"]})]}),(0,S.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",mt:2},children:[(0,S.jsxs)(x.A,{variant:"subtitle1",children:[c("Price"),":"]}),(0,S.jsx)(x.A,{variant:"body1",sx:{ml:1},children:(0,He.$)((n=e.price,i=e.discount,n*(1-(null!==i&&void 0!==i?i:0)/100)))}),e.discount>0&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(et,{variant:"body2",children:(0,He.$)(e.price)}),(0,S.jsxs)(tt,{variant:"body2",children:["(-",e.discount,"%)"]})]})]})]}),(0,S.jsxs)(l.A,{mt:2,children:[(0,S.jsx)(x.A,{variant:"subtitle1",children:c("Description")}),(0,S.jsx)(re.A,{value:e.description||"",onChange:e=>q(t,"description",e),readOnly:!(null!==b&&void 0!==b&&b.id)})]}),(0,S.jsx)(_e.A,{product:e,components:e.components||[]})]})}),(0,S.jsx)(be.Ay,{item:!0,xs:12,md:8,children:(0,S.jsx)(l.A,{children:(0,S.jsx)(Me.A,{components:e.components||[],onComponentChange:e=>((e,t)=>{const n=k.map(((n,i)=>i===e?{...n,components:t}:n));I(n),j(["data","addedProducts"],n)})(t,e)})})})]})]},e.id);var n,i}))}),(null===b||void 0===b?void 0:b.id)&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(l.A,{sx:{mb:6},children:(0,S.jsx)($.A,{startIcon:(0,S.jsx)(ge.A,{}),variant:"contained",onClick:()=>{E(!0)},children:c("AddProduct")})}),(0,S.jsxs)(V.A,{open:P,onClose:W,fullWidth:!0,maxWidth:"md",children:[(0,S.jsx)(G.A,{children:c("AddProduct")}),(0,S.jsxs)(J.A,{children:[(0,S.jsx)(H.A,{autoFocus:!0,margin:"dense",label:c("SearchProducts"),type:"text",fullWidth:!0,variant:"outlined",value:F,onChange:e=>T(e.target.value)}),(0,S.jsx)(l.A,{sx:{mt:2},children:N.map((e=>(0,S.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,borderBottom:"1px solid #e0e0e0",cursor:"pointer"},onClick:()=>(e=>{const t=[...k,e];I(t),j(["data","addedProducts"],t),u("AddedItemToPreventive","success"),W()})(e),children:[(0,S.jsxs)(l.A,{children:[(0,S.jsx)(x.A,{variant:"subtitle1",children:e.name}),(0,S.jsxs)(x.A,{variant:"body2",color:"text.secondary",children:[e.description.substring(0,100),"..."]})]}),(0,S.jsx)(x.A,{variant:"subtitle1",children:(0,He.$)(e.price)})]},e.id)))})]}),(0,S.jsx)(Q.A,{children:(0,S.jsx)($.A,{onClick:W,children:c("Cancel")})})]})]}),(0,S.jsxs)(l.A,{sx:{mb:6,mt:4,p:4,border:"1px solid #e0e0e0",borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.05)",backgroundColor:"#f9f9f9",position:"relative",overflow:"hidden"},children:[(0,S.jsx)(l.A,{sx:{position:"absolute",top:0,left:0,width:"8px",height:"100%",backgroundColor:"primary.main"}}),(0,S.jsxs)(x.A,{variant:"h6",sx:{mb:3,fontWeight:"bold",display:"flex",alignItems:"center",color:"primary.main"},children:[(0,S.jsx)(l.A,{component:"span",sx:{mr:1,display:"inline-flex",p:.5,borderRadius:"50%",backgroundColor:"primary.light",color:"white"},children:(0,S.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:(0,S.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"})})}),c("PaymentTerms")]}),(0,S.jsx)(l.A,{sx:{backgroundColor:"white",p:2,borderRadius:1,border:"1px solid #eaeaea"},children:null!==b&&void 0!==b&&b.id?(0,S.jsx)(re.A,{value:L,onChange:e=>{O(e),j(["data","paymentTerms"],e)},readOnly:!(null!==b&&void 0!==b&&b.id)}):(0,S.jsx)(x.A,{variant:"body1",sx:{lineHeight:1.6,fontWeight:L.includes("MODALITA")?"medium":"normal"},children:L})}),(null===b||void 0===b?void 0:b.id)&&(0,S.jsx)(x.A,{variant:"caption",sx:{display:"block",mt:1,color:"text.secondary",fontStyle:"italic"},children:c("EditPaymentTermsInfo","Edit the payment terms above to customize the conditions")})]}),(0,S.jsx)(l.A,{sx:{mb:6},children:(0,S.jsx)(Te,{})}),(0,S.jsx)(l.A,{sx:{mb:6},children:(0,S.jsx)(Ze,{})})]}):(0,S.jsx)(l.A,{children:c("No document data available")})},et=(0,Se.Ay)(x.A)({textDecoration:"line-through",marginLeft:"4px",color:"#999"}),tt=(0,Se.Ay)(x.A)({marginLeft:"4px",color:"#4caf50"}),nt=(0,o.memo)((0,Se.Ay)(l.A)({marginBottom:"32px",padding:"24px",backgroundColor:"#ffffff",borderRadius:"4px",position:"relative",transition:"all 0.3s ease","&:hover":{boxShadow:"0 0 0 2px #e4e4e4"}})),it=(0,Se.Ay)(Ce.A)({position:"absolute",top:"8px",right:"8px",color:"#000000","&:hover":{color:"#ff0000"}}),lt=()=>{const{originalDocumentData:e,setUpdatedDocumentData:t}=(0,s.u)(),[n,i]=(0,o.useState)(),[l,d]=(0,o.useState)(!0),[c,u]=(0,o.useState)(!0),{user:x,verifyToken:h}=(0,a.A)();if((0,o.useEffect)((()=>{u(!0);(async()=>{try{await h(),"admin"===(null===x||void 0===x?void 0:x.role)&&d(!1)}catch(e){console.error("Authorization error:",e)}finally{u(!1)}})()}),[]),c)return(0,S.jsx)(r.A,{});return(0,S.jsx)(ot,{children:l?(0,S.jsx)(je,{setIsLocked:d}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(st,{children:(0,S.jsx)(Xe,{activeRevisionLabel:null===n||void 0===n?void 0:n.label,revisionData:null===n||void 0===n?void 0:n.snapshot})}),(0,S.jsx)(at,{children:(0,S.jsx)(de,{selectedRevisionId:null===n||void 0===n?void 0:n.id,handleChosenRevision:n=>{if(n&&n.snapshot)try{i(n),t({...e,data:n.snapshot})}catch(l){console.error("Error parsing snapshot data:",l)}else console.error("Revision data is undefined or missing",n)}})})]})})},ot=(0,i.A)(l.A)`
    display: grid;
    grid-template-columns: 3fr 1fr;
    height: 100vh;
    overflow: hidden;
`,st=(0,i.A)(l.A)`
    margin-top: 60px;
    overflow-y: auto;
    padding: 20px;
`,at=(0,i.A)(l.A)`
    position: fixed;
    top: 60px;
    right: 0;
    width: 25%;
    height: calc(100vh - 60px);
    overflow-y: auto;
    background: #fff;
    padding: 10px;
    min-width: 400px;
`},5693:(e,t,n)=>{n.d(t,{$:()=>i});const i=e=>Number(e).toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")},7996:(e,t,n)=>{e.exports=n.p+"static/media/fallbackProduct.d869ab9fc469a3d71e51.png"}}]);
//# sourceMappingURL=48.dee6009b.chunk.js.map